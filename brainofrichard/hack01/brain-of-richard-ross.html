<!doctype html>
<html lang="en">
<head>
<title>brain of richard ross</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<script src='http://mrdoob.github.com/three.js/build/three.min.js'></script>
<script src='http://mrdoob.github.com/three.js/examples/js/Stats.js'></script>
<script src='http://mrdoob.github.com/three.js//examples/js/DAT.GUI.min.js'></script>
<script src="http://mrdoob.github.com/three.js/examples/js/Detector.js"></script>
<!--
<script src="../../three.js/build/three.min.js"></script>
<script src="../../three.js/examples/js/Detector.js"></script>
<script src="../../three.js/examples/js/Stats.js"></script>
-->
</head>
<body>
<script>
	if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

	document.body.style.font = '12px monospace';
	document.body.style.margin = '0';
	document.body.style.overflow = 'hidden';
	document.body.style.textAlign = 'center';
	
	var info = document.createElement( 'div' );
	document.body.appendChild( info );
	info.style.top = '10px';
	info.style.color = '#000';
	info.style.position = 'absolute';
	info.style.width = '100%';
	info.innerHTML = 'brain of richard ross 2012-01-18 ~ ' +
	'<a href="JavaScript:camera.position.set(200, 100, 250);">Home</a>' +
	' ~ <a href="JavaScript:camera.position.set(0, 200, 0);">Top</a>' ;

    var scene, camera, controls, light, stats, renderer;
    var geometry, map, material, mesh, axis, box;
	var clock = new THREE.Clock();
	
		// need this
	var projector;
	var intersected;
	
	var gui, objConfig = {
		opacityDefault: 0.2,
		opacityHighlight: 0.8,
		cameraCutoffNear: 1,
		cameraCutoffFar: 500,
		axisVisible: false,
		boxVisible: false,
		boxX: 0,
		boxY: 0,
		boxZ: 0,
		boxScaleX: 0,
		boxScaleY: 0,
		boxScaleZ: 0,
	};
	var scans = [];

    init();
    animate();
	
    function init() {
	
		container = document.createElement( 'div' );
		document.body.appendChild( container );

        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 10, 10000 );
        camera.position.set(200, 100, 250);
		
        scene.add( camera );
/*
		light = new THREE.AmbientLight( 0xffffff );
		scene.add( light );

		light = new THREE.DirectionalLight( 0xffffff );
		light.position.set( 100, 100, 100 ).normalize();
		scene.add( light );	
		
		light = new THREE.PointLight( 0xff0040, 20, 100 );
		light.position.set( -50, 50, 50);
		scene.add( light );		
*/		
		geometry = new THREE.PlaneGeometry( 200, 200, 10, 10 );
		var scans = [];
		
		for (var i = 1; i < 27; i++) {
			map = THREE.ImageUtils.loadTexture( i + '.png' );
			// map.wrapS = map.wrapT = THREE.RepeatWrapping;
			material = new THREE.MeshBasicMaterial( { color: 0xffffff, ambient: 0xffffffff, map: map, opacity: objConfig.opacityDefault, side: THREE.DoubleSide, transparent: true, wireframe: false} );	
			mesh = new THREE.Mesh( geometry, material );
			mesh.rotation.x = 1.5708;
			mesh.position.set(0, -80 + i * 5, 0);
			scans.push( mesh);
			scene.add( mesh );
		}	
		
		geometry = new THREE.CubeGeometry( 500, 0.1, 500, 10, 10, 10);
		material = new THREE.MeshNormalMaterial( { wireframe: true } );
		//material = new THREE.MeshBasicMaterial( { color: 0xffffff, ambient: 0xffffff, opacity: 0.3, side: THREE.DoubleSide, transparent: true } );		
		mesh = new THREE.Mesh( geometry, material );
		mesh.position.set(0, -80, 0);
		scene.add( mesh );	
		
		gui = new DAT.GUI( { height: 12 * 32 - 1});
		
		gui.add( objConfig, 'opacityDefault', 0.005, 1).step(0.01).onChange( function() {
			for (var i = 0, l = scans.length; i < l; i++) {
				scans[i].material.opacity = ( objConfig.opacityDefault );
			}
		} );
		
		gui.add( objConfig, 'opacityHighlight', 0.01, 1 ).onChange( function() {
		} );
		
		gui.add( objConfig, 'cameraCutoffNear', 1, 500 ).onChange( function() {
			camera.near = objConfig.cameraCutoffNear;
			camera.updateProjectionMatrix();		
		} );	

		gui.add( objConfig, 'cameraCutoffFar', 1, 500 ).onChange( function() {
			camera.far = objConfig.cameraCutoffFar;
			camera.updateProjectionMatrix();
		} );	

		gui.add( objConfig, 'axisVisible', true ).onChange( function() {
			if ( !objConfig.axisVisible) {
				objConfig.axisVisible = false;
				scene.remove( axis );
			} else {
				objConfig.axisVisible = true;
				axis = new THREE.AxisHelper();
				axis.position.set( 0, 0, 0 );
				axis.scale.x = axis.scale.y = axis.scale.z = 0.5;
				scene.add( axis );	
			}			
		} );		

		
		gui.add( objConfig, 'boxVisible', true ).onChange( function() {
			if ( !objConfig.boxVisible) {
				objConfig.boxVisible = false;
				scene.remove( box );
			} else {
				objConfig.boxVisible = true;
				geometry = new THREE.CubeGeometry( 20, 20, 20);
				material = new THREE.MeshNormalMaterial( { wireframe: true } );
				box = new THREE.Mesh( geometry, material );
				box.position.set(0, 0, 0);
				scene.add( box );		
			}			
		} )
		
		gui.add( objConfig, 'boxX', -200, 200 ).onChange( function() {
			if (box) box.position.x = objConfig.boxX;
		} );

		gui.add( objConfig, 'boxY', -200, 200 ).onChange( function() {
			if (box) box.position.y = objConfig.boxY;
		} );		

		gui.add( objConfig, 'boxZ', -200, 200 ).onChange( function() {
			if (box) box.position.z = objConfig.boxZ;
		} );	
		

		gui.add( objConfig, 'boxScaleX', -200, 200 ).onChange( function() {
			if (box) box.scale.x = objConfig.boxScaleX;
		} );

		gui.add( objConfig, 'boxScaleY', -200, 200 ).onChange( function() {
			if (box) box.scale.y = objConfig.boxScaleY;
		} );		

		gui.add( objConfig, 'boxScaleZ', -200, 200 ).onChange( function() {
			if (box) box.scale.z = objConfig.boxScaleZ;
		} );
		
		// gui.close();	

		
				
		stats = new Stats();
		stats.domElement.style.position = 'absolute';
		stats.domElement.style.top = '0px';
		stats.domElement.style.zIndex = 100;
		container.appendChild( stats.domElement );		

		projector = new THREE.Projector();	
		
        renderer = new THREE.WebGLRenderer( {antialias: true } );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );
		
		controls = new THREE.TrackballControls( camera, renderer.domElement );
		controls.zoomSpeed = 0.05;
		controls.maxDistance = 800;
		
		document.addEventListener( 'mousemove', onDocumentMouseMove, false );
    }
	
    function animate() {
        requestAnimationFrame( animate );
        render();
		stats.update();
    }

    function render() {		
		controls.update( clock.getDelta() );
		// camera.lookAt( scene.position);
        renderer.render( scene, camera );
    }
	
	function onDocumentMouseMove( event ) { // needs work - see also above
		var vector = new THREE.Vector3( ( event.clientX / window.innerWidth ) * 2 - 1, - ( event.clientY / window.innerHeight ) * 2 + 1, 0.5 );
		projector.unprojectVector( vector, camera );
		var ray = new THREE.Ray( camera.position, vector.subSelf( camera.position ).normalize() );
		var intersects = ray.intersectObjects( scene.children );
		if ( intersects.length > 0 ) {	
			if ( intersected != intersects[ 0 ].object ) {
				if ( intersected ) { intersected.material.opacity = objConfig.opacityDefault; }
				intersected = intersects[ 0 ].object;
				intersected.material.opacity = objConfig.opacityHighlight;
			}		
		} else {
			if (intersected) intersected.material.opacity = objConfig.opacityDefault;
			intersected = null;

		}	
	}	
			
</script>
</body>
</html>